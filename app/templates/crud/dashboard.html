<!--
AI declaration:
Github copilot was used for portions of the planning, research, feedback and editing of the software artefact. Mostly utilised for syntax, logic and error checking with ChatGPT and Claude Sonnet 4.5 used as the models.

This HTML page is for the administrator dashboard form, using Jinja2 and py Flask templating, with Bootstrap 5 for styling, FontAwesome for icons, and Chart.js for data visualizations.

(Anthropic, 2025).
-->
{% extends "base.html" %}
{% block title %}Dashboard - Records Manager{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard-specific styles only */
    
    /* Override Bootstrap container to use full width with minimal padding */
    .container-fluid {
        max-width: 98%; /* Use 98% of viewport width instead of default ~1140px */
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    .stats-panel {
        position: sticky;
        top: 20px;
        max-height: calc(100vh - 100px);
        overflow-y: auto;
    }
    
    .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 15px;
    }
    
    .stat-card h3 {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .chart-container {
        height: 250px;
    }
    
    .records-panel {
        background-color: #fff;
        border-radius: 10px;
        padding: 20px;
    }
    
    /* Improved table layout for AI prediction column */
    .table-responsive {
        overflow-x: auto;
    }
    
    .patient-table {
        min-width: 1200px;
        font-size: 0.875rem;
    }
    
    .patient-table th,
    .patient-table td {
        padding: 0.5rem;
        white-space: nowrap;
    }
    
    /* Column width adjustments for better space utilization */
    .patient-table th:nth-child(1), .patient-table td:nth-child(1) { width: 4%; }  /* ID */
    .patient-table th:nth-child(2), .patient-table td:nth-child(2) { width: 4%; }  /* Gender */
    .patient-table th:nth-child(3), .patient-table td:nth-child(3) { width: 4%; }  /* Age */
    .patient-table th:nth-child(4), .patient-table td:nth-child(4) { width: 7%; }  /* HTN */
    .patient-table th:nth-child(5), .patient-table td:nth-child(5) { width: 7%; }  /* Heart */
    .patient-table th:nth-child(6), .patient-table td:nth-child(6) { width: 7%; }  /* Glucose */
    .patient-table th:nth-child(7), .patient-table td:nth-child(7) { width: 5%; }  /* BMI */
    .patient-table th:nth-child(8), .patient-table td:nth-child(8) { width: 8%; }  /* Smoking */
    .patient-table th:nth-child(9), .patient-table td:nth-child(9) { width: 6%; }  /* Stroke */
    .patient-table th:nth-child(10), .patient-table td:nth-child(10) { 
        width: 12%; 
        text-align: center;
    }  /* AI Prediction */
    .patient-table th:nth-child(11), .patient-table td:nth-child(11) { width: 10%; }  /* Actions */
</style>
{% endblock %}

<!-- (Anthropic, 2025) -->
{% block content %}
<div class="container-fluid">
    <div class="row mb-3">
        <div class="col-12">
            <h2 class="mb-3">
                <i class="fas fa-chart-line"></i> Patient Records Dashboard
            </h2>
        <div class="mb-3">
            <a href="{{ url_for('crud.create_patient') }}" class="btn btn-success">
                <i class="fas fa-plus-circle"></i> New Patient Record
            </a>
            <a href="{{ url_for('auth.userpage') }}" class="btn btn-info">
                <i class="fas fa-user-cog"></i> Account Settings
            </a>
        </div>
    </div>
</div>

<div class="row">
    <!-- Left Panel: Statistics and Visualizations, (Anthropic, 2025). -->
    <div class="col-lg-3 col-md-12">
        <div class="stats-panel">
            {% if stats and stats.total_records > 0 %}
            <!-- Total Records Card -->
            <div class="stat-card">
                <p class="mb-1"><i class="fas fa-database"></i> Total Records</p>
                <h3>{{ stats.total_records }}</h3>
                <small>Patients in database</small>
            </div>
            
            <!-- Stroke Risk Overview Card with AI Predictions, (Anthropic, 2025). -->
            <div class="card mb-3">
                <div class="card-header bg-danger text-white">
                    <i class="fas fa-heartbeat"></i> Stroke Risk Analysis
                </div>
                <div class="card-body">
                    <h6 class="text-center mb-3">Historical Records</h6>
                    <div class="chart-container">
                        <canvas id="strokeChart"></canvas>
                    </div>
                    <div class="text-center mt-2">
                        <span class="badge bg-danger">{{ stats.stroke_count }} confirmed strokes ({{ stats.stroke_percentage }}%)</span>
                        <span class="badge bg-success">{{ stats.no_stroke_count }} no stroke history ({{ stats.no_stroke_percentage }}%)</span>
                    </div>
                    
                    {% if model_metadata and stats.ai_predictions %}
                    <hr class="my-3">
                    <h6 class="text-center mb-3">AI Risk Assessment (Current Database)</h6>
                    <div class="chart-container">
                        <canvas id="aiPredictionChart"></canvas>
                    </div>
                    <div class="text-center mt-2">
                        <span class="badge bg-danger">{{ stats.ai_predictions.high_risk_count }} high risk predictions</span>
                        <span class="badge bg-warning">{{ stats.ai_predictions.moderate_risk_count }} moderate risk</span>
                        <span class="badge bg-success">{{ stats.ai_predictions.low_risk_count }} low risk</span>
                    </div>
                    <small class="text-muted d-block mt-2 text-center">
                        <i class="fas fa-info-circle"></i> AI predictions based on {{ "%.2f"|format(model_metadata.accuracy * 100) }}% accurate model
                    </small>
                    {% endif %}
                </div>
            </div>
            
            <!-- Conditions Card, (Anthropic, 2025). -->
            <div class="card mb-3">
                <div class="card-header bg-warning text-dark">
                    <i class=""></i> Medical Conditions
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted">Hypertension</small>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-warning" role="progressbar" 
                                 style="width: {{ stats.hypertension_percentage }}%">
                                {{ stats.hypertension_count }} ({{ stats.hypertension_percentage }}%)
                            </div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Heart Disease</small>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-danger" role="progressbar" 
                                 style="width: {{ stats.heart_disease_percentage }}%">
                                {{ stats.heart_disease_count }} ({{ stats.heart_disease_percentage }}%)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gender Distribution Card, (Anthropic, 2025). -->
            <div class="card mb-3">
                <div class="card-header bg-primary text-white">
                    <i class=""></i> Gender Distribution
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="genderChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Smoking Status Card, (Anthropic, 2025). -->
            <div class="card mb-3">
                <div class="card-header bg-info text-white">
                    <i class=""></i> Smoking Status
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="smokingChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Age Distribution Card, (Anthropic, 2025). -->
            <div class="card mb-3">
                <div class="card-header bg-secondary text-white">
                    <i class=""></i> Age Distribution
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="ageChart"></canvas>
                    </div>
                </div>
            </div>

            {% if model_metadata and model_metadata.accuracy %}
            <!-- AI Model Performance Card -->
            <div class="card mb-3">
                <div class="card-header bg-success text-white">
                    <i class="fas fa-robot"></i> AI Model Performance
                </div>
                <div class="card-body">
                    <h6 class="text-center mb-3">SVM Stroke Prediction Model</h6>
                    <div class="chart-container" style="height: 200px;">
                        <canvas id="modelAccuracyChart"></canvas>
                    </div>
                    <div class="mt-3">
                        <small class="d-block"><strong>Accuracy:</strong> {{ "%.4f"|format(model_metadata.accuracy * 100) }}%</small>
                        <small class="d-block"><strong>Precision:</strong> {{ "%.4f"|format(model_metadata.precision * 100) }}%</small>
                        <small class="d-block"><strong>Recall:</strong> {{ "%.4f"|format(model_metadata.recall * 100) }}%</small>
                        <small class="d-block"><strong>F1-Score:</strong> {{ "%.4f"|format(model_metadata.f1_score * 100) }}%</small>
                    </div>
                    <small class="text-muted d-block mt-2">
                        <i class="fas fa-info-circle"></i> Model trained using Random Oversampling + GridSearchCV
                    </small>
                </div>
            </div>
            {% endif %}
            
            {% else %}
            <div class="alert alert-info">
                <i class=""></i> No data available for visualizations.
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Right Panel: Patient Records List, (Anthropic, 2025). -->
    <div class="col-lg-9 col-md-12">
        <div class="records-panel">
            <!-- Search and Filter Card, (Anthropic, 2025). -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-search"></i> Search & Filter
                </div>
                <div class="card-body">
                    <form method="GET" action="{{ url_for('crud.dashboard') }}" class="row g-3">
                        <div class="col-md-4">
                            {{ search_form.search_field.label(class="form-label") }}
                            {{ search_form.search_field(class="form-control") }}
                        </div>
                        <div class="col-md-4">
                            {{ search_form.search_value.label(class="form-label") }}
                            {{ search_form.search_value(class="form-control", placeholder="Enter search value") }}
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary me-2">
                                <i class="fas fa-search"></i> Search
                            </button>
                            <a href="{{ url_for('crud.dashboard') }}" class="btn btn-secondary">
                                <i class="fas fa-redo"></i> Reset
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> 
                Showing <strong>{{ records|length }}</strong> of <strong>{{ total }}</strong> total records
                {% if search_field and search_value %}
                    (filtered by {{ search_field }}: {{ search_value }})
                {% endif %}
            </div>
            
            <!-- Patient Records Table, (Anthropic, 2025). -->
            {% if records %}
            <div class="card">
                <div class="card-body table-responsive">
                    <table class="table table-hover table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Gender</th>
                                <th>Age</th>
                                <th>Hypertension</th>
                                <th>Heart Disease</th>
                                <th>Glucose</th>
                                <th>BMI</th>
                                <th>Smoking</th>
                                <th>Stroke</th>
                                {% if model_metadata %}
                                <th><i class=""></i> AI Risk % = confidence</th>
                                {% endif %}
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for record in records %}
                            <tr>
                                <td>{{ record.id if record.id else 'N/A' }}</td>
                                <td>
                                    {% if record.gender == 'Male' %}
                                        <i class="fas fa-mars text-primary"></i>
                                    {% elif record.gender == 'Female' %}
                                        <i class="fas fa-venus text-danger"></i>
                                    {% else %}
                                        <i class="fas fa-genderless"></i>
                                    {% endif %}
                                </td>
                                <td>{{ record.age }}</td>
                                <td>
                                    {% if record.hypertension == 1 %}
                                        <span class="badge bg-warning">Yes</span>
                                    {% else %}
                                        <span class="badge bg-secondary">No</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if record.heart_disease == 1 %}
                                        <span class="badge bg-warning">Yes</span>
                                    {% else %}
                                        <span class="badge bg-secondary">No</span>
                                    {% endif %}
                                </td>
                                <td>{{ "%.1f"|format(record.avg_glucose_level) }}</td>
                                <td>{{ record.bmi }}</td>
                                <td>
                                    {% if record.smoking_status == 'smokes' %}
                                        <span class="badge bg-danger">Smokes</span>
                                    {% elif record.smoking_status == 'formerly smoked' %}
                                        <span class="badge bg-warning">Former</span>
                                    {% elif record.smoking_status == 'never smoked' %}
                                        <span class="badge bg-success">Never</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Unknown</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if record.stroke == 1 %}
                                        <span class="badge bg-danger">Yes</span>
                                    {% else %}
                                        <span class="badge bg-success">No</span>
                                    {% endif %}
                                </td>
                                {% if model_metadata and record.ai_prediction %}
                                <td>
                                    {% if record.ai_prediction.prediction == 1 %}
                                        <span class="badge bg-danger" title="Risk Level: {{ record.ai_prediction.risk_level|capitalize }}">
                                            <i class="fas fa-exclamation-triangle"></i> High Risk
                                        </span>
                                        <small class="d-block text-muted">{{ record.ai_prediction.confidence }}%</small>
                                    {% elif record.ai_prediction.prediction == 0 %}
                                        <span class="badge bg-success" title="Risk Level: {{ record.ai_prediction.risk_level|capitalize }}">
                                            <i class="fas fa-check-circle"></i> Low Risk
                                        </span>
                                        <small class="d-block text-muted">{{ 100 - record.ai_prediction.confidence }}%</small>
                                    {% else %}
                                        <span class="badge bg-secondary">
                                            <i class="fas fa-question-circle"></i> N/A
                                        </span>
                                    {% endif %}
                                </td>
                                {% endif %}
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="{{ url_for('crud.view_patient', patient_id=record._id) }}" 
                                           class="btn btn-info" title="View">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{{ url_for('crud.edit_patient', patient_id=record._id) }}" 
                                           class="btn btn-warning" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <button type="button" class="btn btn-danger" 
                                                onclick="confirmDelete('{{ record._id }}')" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Pagination, (Anthropic, 2025). -->
            {% if total_pages > 1 %}
            <nav aria-label="Page navigation" class="mt-4">
                <ul class="pagination justify-content-center">
                    {% if page > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('crud.dashboard', page=page-1, search_field=search_field, search_value=search_value) }}">
                            Previous
                        </a>
                    </li>
                    {% endif %}
                    {% for p in range(1, total_pages + 1) %}
                        {% if p == page %}
                            <li class="page-item active"><span class="page-link">{{ p }}</span></li>
                        {% elif p <= 3 or p > total_pages - 3 or (p >= page - 1 and p <= page + 1) %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('crud.dashboard', page=p, search_field=search_field, search_value=search_value) }}">{{ p }}</a>
                            </li>
                        {% elif p == 4 or p == total_pages - 3 %}
                            <li class="page-item disabled"><span class="page-link">...</span></li>
                        {% endif %}
                    {% endfor %}
                    {% if page < total_pages %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('crud.dashboard', page=page+1, search_field=search_field, search_value=search_value) }}">
                            Next
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
            
            {% else %}
            <div class="alert alert-warning text-center">
                <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                <h4>No Records Found</h4>
                <p>There are no patient records in the database. 
                   {% if total == 0 %}
                   CSV data will be imported automatically on next application restart, or you can 
                   {% endif %}
                   <a href="{{ url_for('crud.create_patient') }}" class="alert-link">create a new record</a>.
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal, (Anthropic, 2025). -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle"></i> Confirm Deletion
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this patient record?</p>
                <p class="text-danger"><strong>This action cannot be undone.</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteForm" method="POST" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js CDN, (Anthropic, 2025). -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
    function confirmDelete(patientId) {
        const deleteForm = document.getElementById('deleteForm');
        deleteForm.action = `/patient/${patientId}/delete`;
        
        const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
        modal.show();
    }
    
    {% if stats and stats.total_records > 0 %}
    // Chart.js Configuration, (Anthropic, 2025).
    Chart.defaults.font.family = 'Arial, sans-serif';
    Chart.defaults.color = '#666';
    
    // Stroke Distribution Pie Chart (Historical), (Anthropic, 2025).
    const strokeCtx = document.getElementById('strokeChart').getContext('2d');
    new Chart(strokeCtx, {
        type: 'doughnut',
        data: {
            labels: ['Confirmed Stroke', 'No Stroke History'],
            datasets: [{
                data: [{{ stats.stroke_count }}, {{ stats.no_stroke_count }}],
                backgroundColor: ['#e74c3c', '#27ae60'],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            let value = context.parsed || 0;
                            let percentage = ((value / {{ stats.total_records }}) * 100).toFixed(1);
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                },
                title: {
                    display: true,
                    text: 'Historical Stroke Records',
                    font: { size: 14 }
                }
            }
        }
    });
    
    {% if stats and stats.total_records > 0 %}
    // AI Prediction Risk Distribution Chart
    const aiPredCtx = document.getElementById('aiPredictionChart').getContext('2d');
    new Chart(aiPredCtx, {
        type: 'doughnut',
        data: {
            labels: ['High Risk', 'Moderate Risk', 'Low Risk'],
            datasets: [{
                data: [
                    {{ stats.ai_predictions.high_risk_count }}, 
                    {{ stats.ai_predictions.moderate_risk_count }}, 
                    {{ stats.ai_predictions.low_risk_count }}
                ],
                backgroundColor: ['#e74c3c', '#f39c12', '#27ae60'],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            let value = context.parsed || 0;
                            let percentage = ((value / {{ stats.total_records }}) * 100).toFixed(1);
                            return `${label}: ${value} patients (${percentage}%)`;
                        }
                    }
                },
                title: {
                    display: true,
                    text: 'AI Risk Predictions',
                    font: { size: 14 }
                }
            }
        }
    });
    {% endif %}
    
    // Gender Distribution Pie Chart, (Anthropic, 2025).
    const genderCtx = document.getElementById('genderChart').getContext('2d');
    new Chart(genderCtx, {
        type: 'pie',
        data: {
            labels: ['Male', 'Female', 'Other'],
            datasets: [{
                data: [
                    {{ stats.gender_counts.Male }}, 
                    {{ stats.gender_counts.Female }}, 
                    {{ stats.gender_counts.Other }}
                ],
                backgroundColor: ['#3498db', '#e74c3c', '#95a5a6'],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
    
    // Smoking Status Bar Chart, (Anthropic, 2025).
    const smokingCtx = document.getElementById('smokingChart').getContext('2d');
    new Chart(smokingCtx, {
        type: 'bar',
        data: {
            labels: ['Never', 'Former', 'Smokes', 'Unknown'],
            datasets: [{
                label: 'Patients',
                data: [
                    {{ stats.smoking_counts['never smoked'] }},
                    {{ stats.smoking_counts['formerly smoked'] }},
                    {{ stats.smoking_counts['smokes'] }},
                    {{ stats.smoking_counts['Unknown'] }}
                ],
                backgroundColor: ['#27ae60', '#f39c12', '#e74c3c', '#95a5a6'],
                borderWidth: 1,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
    
    // Age Distribution Line Chart, (Anthropic, 2025).
    const ageCtx = document.getElementById('ageChart').getContext('2d');
    new Chart(ageCtx, {
        type: 'line',
        data: {
            labels: ['0-20', '21-40', '41-60', '61-80', '81+'],
            datasets: [{
                label: 'Patients',
                data: [
                    {{ stats.age_groups['0-20'] }},
                    {{ stats.age_groups['21-40'] }},
                    {{ stats.age_groups['41-60'] }},
                    {{ stats.age_groups['61-80'] }},
                    {{ stats.age_groups['81+'] }}
                ],
                backgroundColor: 'rgba(52, 152, 219, 0.2)',
                borderColor: '#3498db',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
    
    {% if model_metadata and model_metadata.accuracy %}
    // AI Model Performance Gauge Chart
    const modelCtx = document.getElementById('modelAccuracyChart').getContext('2d');
    new Chart(modelCtx, {
        type: 'doughnut',
        data: {
            labels: ['Accuracy', 'Error'],
            datasets: [{
                data: [
                    {{ model_metadata.accuracy * 100 }}, 
                    {{ (1 - model_metadata.accuracy) * 100 }}
                ],
                backgroundColor: ['#27ae60', '#e74c3c'],
                borderWidth: 2,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            rotation: -90,
            circumference: 180,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            let value = context.parsed || 0;
                            return `${label}: ${value.toFixed(4)}%`;
                        }
                    }
                },
                title: {
                    display: true,
                    text: '{{ "%.4f"|format(model_metadata.accuracy * 100) }}% Accuracy',
                    font: {
                        size: 16,
                        weight: 'bold'
                    }
                }
            }
        }
    });
    {% endif %}
    {% endif %}
</script>
{% endblock %}